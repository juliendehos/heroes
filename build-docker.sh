#! /bin/sh

echo ""
echo ""###############################################################################
echo "# clean previous build"
echo ""###############################################################################
make clean

echo ""
echo ""###############################################################################
echo "# build client"
echo ""###############################################################################
nix develop .#wasm --experimental-features "nix-command flakes" --command bash -c "make"
nix-build app-client.nix

echo ""
echo ""###############################################################################
echo "# build server"
echo ""###############################################################################
nix-build app-server.nix

echo ""
echo ""###############################################################################
echo "# build docker image"
echo ""###############################################################################
nix-build docker.nix
docker load < result

